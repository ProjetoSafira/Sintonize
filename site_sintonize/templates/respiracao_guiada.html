{% extends 'base.html' %}
{% load static %}

{% block title %}Respiração Guiada{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/respiracao.css' %}">
{% endblock %}

{% block content %}
<div class="respiracao-container">
  <svg xmlns="http://www.w3.org/2000/svg" width="1440px" height="674px" viewBox="0 0 1440 674" fill="none" class="background-svg">
    <g filter="url(#filter0_dd_11836_5226)">
      <path d="M1440 18C1440 11.3726 1434.63 6 1428 6H10.9999C4.37256 6 -1 11.3726 -1 18V650C-1 656.627 4.37256 662 11 662H1428C1434.63 662 1440 656.627 1440 650V18Z" fill="url(#paint0_linear_11836_5226)" shape-rendering="crispEdges"/>
    </g>
    <defs>
      <filter id="filter0_dd_11836_5226" x="-9" y="0" width="1457" height="674" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
        <feOffset dy="2"/>
        <feGaussianBlur stdDeviation="4"/>
        <feComposite in2="hardAlpha" operator="out"/>
        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0.337255 0 0 0 0 0.8 0 0 0 0.06 0"/>
        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_11836_5226"/>
        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
        <feOffset dy="4"/>
        <feGaussianBlur stdDeviation="4"/>
        <feComposite in2="hardAlpha" operator="out"/>
        <feColorMatrix type="matrix" values="0 0 0 0 0.898039 0 0 0 0 0.905882 0 0 0 0 0.921569 0 0 0 0.08 0"/>
        <feBlend mode="normal" in2="effect1_dropShadow_11836_5226" result="effect2_dropShadow_11836_5226"/>
        <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_11836_5226" result="shape"/>
      </filter>
      <linearGradient id="paint0_linear_11836_5226" x1="719.5" y1="6" x2="719.5" y2="662" gradientUnits="userSpaceOnUse">
        <stop stop-color="#FEFEFE"/>
        <stop offset="1" stop-color="#FAFAFA" stop-opacity="0.5"/>
      </linearGradient>
    </defs>
  </svg>

  <div class="animacao-container">
    <div class="circulo-container">
      <svg viewBox="0 0 200 200" width="100%" height="100%">
        <circle cx="100" cy="100" r="80" class="circulo-inspire" />
        <circle cx="100" cy="100" r="80" class="circulo-segure" />
        <circle cx="100" cy="100" r="80" class="circulo-expira" />
      </svg>

      <div class="ponto-topo">
        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
          <circle cx="4" cy="4" r="4" fill="#476970"/>
        </svg>
      </div>
      
      <div class="texto-central" id="texto-respiracao">COMEÇAR</div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const pontoTopo = document.querySelector('.ponto-topo');
    const textoRespiracao = document.getElementById('texto-respiracao');
    const circuloContainer = document.querySelector('.circulo-container');
    let animacaoAtiva = false;

    function atualizarTexto(tempo) {
        if (tempo <= 4000) { // 0-4s: Inspire (verde claro)
            textoRespiracao.textContent = 'INSPIRE';
            textoRespiracao.className = 'texto-central texto-inspire';
        } else if (tempo <= 11000) { // 4-11s: Segure (cinza)
            textoRespiracao.textContent = 'SEGURE';
            textoRespiracao.className = 'texto-central texto-segure';
        } else { // 11-19s: Expire (verde)
            textoRespiracao.textContent = 'EXPIRE';
            textoRespiracao.className = 'texto-central texto-expira';
        }
    }

    function iniciarAnimacao() {
        if (!animacaoAtiva) {
            animacaoAtiva = true;
            pontoTopo.classList.add('animando');
            circuloContainer.classList.add('animando');
            
            let tempoInicio = Date.now();
            const intervalo = setInterval(() => {
                let tempoDecorrido = (Date.now() - tempoInicio) % 19000;
                atualizarTexto(tempoDecorrido);
            }, 100);

            textoRespiracao.onclick = function() {
                animacaoAtiva = false;
                pontoTopo.classList.remove('animando');
                circuloContainer.classList.remove('animando');
                clearInterval(intervalo);
                textoRespiracao.textContent = 'COMEÇAR';
                textoRespiracao.className = 'texto-central';
                textoRespiracao.onclick = iniciarAnimacao;
            };
        }
    }

    textoRespiracao.onclick = iniciarAnimacao;
});
</script>
{% endblock %}

